@model eidss.model.Schema.GeoLocation

@using eidss.webclient.Utils

<script language="javascript" type="text/javascript">
    function OpenMap() {
        var link = '@Url.Action("Get", "Map")';        
        var lat = $('@String.Format("#{0}dblLatitude", Model.ObjectIdent)').data('tTextBox').value();
        var lon = $('@String.Format("#{0}dblLongitude", Model.ObjectIdent)').data('tTextBox').value(); ;

        var args = '';
        if (lat != null && lon != null)
            args += '?lat=' + lat + '&lon=' + lon;

        if (args == '') {
            var regc = $('[id$="_Region"][class*="fillAll"]').data('tComboBox');
            var rayc = $('[id$="_Rayon"][class*="fillAll"]').data('tComboBox');
            var settlec = $('[id$="_Settlement"][class*="fillAll"]').data('tComboBox');

            if (regc && rayc && settlec) {
                var reg = regc.value();
                var ray = rayc.value();
                var settle = settlec.value();
                if (reg != null && ray != null && settle != null) {
                    args += '?region=' + reg + '&rayon=' + ray + '&settlement=' + settle;
                }
            }
        }

        $("#MapOpenerId").val('@Model.ObjectIdent');

        var child = window.open(link + args, "Map", 'menubar=0');
        child.opener = self;
    }

    $(document).ready(function () {
        var buttonSelect = $("#buttonCoordinatesPicker");
        var isButtonsReadOnly = $("#hdnIsReadOnly").val().toLowerCase() == "true";
        if (isButtonsReadOnly) {
            buttonSelect.attr('disabled', 'disabled');
        }
        else {
            buttonSelect.removeAttr('disabled');
        }
    });
</script>

<input type="hidden" id="hdnIsReadOnly" value="@Model.IsReadOnly("buttonCoordinatesPicker")"/>
<input id='@Model.ObjectName' name='@Model.ObjectName' type='hidden' value='@Model.Key' />

<table class="autoWidth">
    <tr>
        <td class="medium">
            @Html.LabelFor(m => m.dblLongitude)&nbsp;(&#177;&#35;.&#35;&#35;&#35;&#35;&#35;&#176;)
        </td>
        <td>
        @if (Model.IsHiddenPersonalData("dblLongitude"))
        {
            @Html.BvHiddenPersonalData("dblLongitude")
        }
        else
        {
            @Html.BvNumeric(Model, "dblLongitude", 5, -180, 180)
        }
        </td>
        <td rowspan="2">
        @if (!Model.IsHiddenPersonalData("dblLongitude"))
        {
            <button id="buttonCoordinatesPicker" onclick="OpenMap();" type="button">
                <img src="@Url.Content(VirtualPathUtility.ToAbsolute("~/Content/Images/Map.jpg"))" alt="Map" />
            </button>
        }
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(m => m.dblLatitude)&nbsp;(&#177;&#35;.&#35;&#35;&#35;&#35;&#35;&#176;)
        </td>
        <td>
         @if (Model.IsHiddenPersonalData("dblLatitude"))
         {
            @Html.BvHiddenPersonalData("dblLatitude")
         }
         else
         {
            @Html.BvNumeric(Model, "dblLatitude", 5, -90, 90)
         }
        </td>
    </tr>
</table>
